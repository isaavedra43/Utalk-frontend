<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- üßπ CONSOLE CLEANER ULTRA AGRESIVO - FILTRA ERRORES DE EXTENSIONES -->
    <script>
      (function () {
        'use strict';

        // ‚úÖ PATRONES ESPEC√çFICOS PARA LOS ERRORES QUE SIGUEN APARECIENDO
        const FILTER_PATTERNS = [
          'chrome-extension://',
          'FrameDoesNotExistError',
          'ERR_FILE_NOT_FOUND',
          'Unchecked runtime.lastError',
          'background.js',
          'extensionState.js',
          'heuristicsRedefi',
          'completion_list.js',
          'PasswordsToolb',
          'Cannot access contents of the page',
          'Extension manifest must request permission',
          'net::ERR_FILE_NOT_FOUND',
          'extension://',
          'devtools://',
          'chrome://',
          'about:',
          'data:',
          'blob:',
          'DelayedMessageSender',
          'Uncaught (in promise)',
          'background.js:1',
          'chrome-extension://p',
          'utils.js:1',
          'extensionState.js:1',
          'heuristicsRedefinitions.js:1',
          'key.svg',
          'PasswordsToolb',
          'message port closed',
          'Could not establish connection',
          'Receiving end does not exist',
          'completion list.html',
          'pejdijmoenmkgeppbflobdenhhabjlaj',
          'background.js:1:48264',
          'DelayedMessageSender.<anonymous>',
          'runtime.lastError',
          'chrome-extension://pejdijmoenmkgeppbflobdenhhabjlaj',
          'Cannot access contents of the page. Extension manifest must request permission',
          'The message port closed before a response was received',
          'Could not establish connection. Receiving end does not exist',
          'Frame does not exist in tab',
          'background.js:1:48264',
          'DelayedMessageSender.<anonymous>',
          'runtime.lastError:',
          'Unchecked runtime.lastError:',
          'chrome-extension://',
          'extension://',
          'background.js',
          'FrameDoesNotExistError: Frame',
          'does not exist in tab'
        ];

        // ‚úÖ FUNCI√ìN ULTRA AGRESIVA PARA VERIFICAR SI ES ERROR DE EXTENSI√ìN
        function isExtensionError(message, source, stack) {
          const fullMessage = `${message} ${source || ''} ${stack || ''}`.toLowerCase();

          // Verificar patrones espec√≠ficos
          const hasExtensionPattern = FILTER_PATTERNS.some(pattern =>
            fullMessage.includes(pattern.toLowerCase())
          );

          // Verificar si contiene chrome-extension en cualquier parte
          const hasChromeExtension = fullMessage.includes('chrome-extension');

          // Verificar si es un error de runtime.lastError
          const hasRuntimeError = fullMessage.includes('runtime.lasterror');

          // Verificar si es un FrameDoesNotExistError
          const hasFrameError = fullMessage.includes('framedoesnotexisterror');

          // Verificar si es un error de background.js
          const hasBackgroundJs = fullMessage.includes('background.js');

          // Verificar si contiene "message port closed"
          const hasMessagePortClosed = fullMessage.includes('message port closed');

          // Verificar si contiene "Could not establish connection"
          const hasConnectionError = fullMessage.includes('could not establish connection');

          // Verificar si contiene "Receiving end does not exist"
          const hasReceivingEndError = fullMessage.includes('receiving end does not exist');

          // Verificar si contiene "Cannot access contents of the page"
          const hasCannotAccessError = fullMessage.includes('cannot access contents of the page');

          // Verificar si contiene "Extension manifest must request permission"
          const hasExtensionPermissionError = fullMessage.includes(
            'extension manifest must request permission'
          );

          return (
            hasExtensionPattern ||
            hasChromeExtension ||
            hasRuntimeError ||
            hasFrameError ||
            hasBackgroundJs ||
            hasMessagePortClosed ||
            hasConnectionError ||
            hasReceivingEndError ||
            hasCannotAccessError ||
            hasExtensionPermissionError
          );
        }

        // ‚úÖ FUNCI√ìN PARA VERIFICAR SI ES DE TU DOMINIO
        function isFromYourDomain(source) {
          if (!source) return true;
          const yourDomains = [
            'utalk-frontend-glt2.vercel.app',
            'localhost',
            '127.0.0.1',
            'vercel.app',
            'utalk-backend-production.up.railway.app'
          ];
          return yourDomains.some(domain => source.includes(domain));
        }

        // ‚úÖ INTERCEPTAR console.error - ULTRA AGRESIVO
        const originalConsoleError = console.error;
        console.error = function (...args) {
          const message = args.join(' ');
          const stack = new Error().stack;

          if (!isExtensionError(message, null, stack)) {
            originalConsoleError.apply(console, args);
          }
        };

        // ‚úÖ INTERCEPTAR console.warn - ULTRA AGRESIVO
        const originalConsoleWarn = console.warn;
        console.warn = function (...args) {
          const message = args.join(' ');
          const stack = new Error().stack;

          if (!isExtensionError(message, null, stack)) {
            originalConsoleWarn.apply(console, args);
          }
        };

        // ‚úÖ INTERCEPTAR console.log - ULTRA AGRESIVO
        const originalConsoleLog = console.log;
        console.log = function (...args) {
          const message = args.join(' ');

          if (!isExtensionError(message, null)) {
            originalConsoleLog.apply(console, args);
          }
        };

        // ‚úÖ INTERCEPTAR window.onerror - ULTRA AGRESIVO
        const originalOnError = window.onerror;
        window.onerror = function (message, source, lineno, colno, error) {
          if (!isExtensionError(message, source)) {
            if (originalOnError) {
              return originalOnError(message, source, lineno, colno, error);
            }
            return false;
          }
          return true;
        };

        // ‚úÖ INTERCEPTAR window.onunhandledrejection - ULTRA AGRESIVO
        const originalOnUnhandledRejection = window.onunhandledrejection;
        window.onunhandledrejection = function (event) {
          const message = event.reason?.message || event.reason || '';
          const stack = event.reason?.stack || '';

          if (!isExtensionError(message, null, stack)) {
            if (originalOnUnhandledRejection) {
              return originalOnUnhandledRejection(event);
            }
            return false;
          }
          return true;
        };

        // ‚úÖ INTERCEPTAR addEventListener para errores de recursos - ULTRA AGRESIVO
        const originalAddEventListener = EventTarget.prototype.addEventListener;
        EventTarget.prototype.addEventListener = function (type, listener, options) {
          if (type === 'error') {
            const wrappedListener = function (event) {
              if (event.target && event.target.src) {
                const src = event.target.src;
                if (
                  src.includes('chrome-extension://') ||
                  src.includes('extension://') ||
                  src.includes('background.js')
                ) {
                  return;
                }
              }
              return listener.call(this, event);
            };
            return originalAddEventListener.call(this, type, wrappedListener, options);
          }
          return originalAddEventListener.call(this, type, listener, options);
        };

        // ‚úÖ INTERCEPTAR fetch para bloquear requests de extensiones
        const originalFetch = window.fetch;
        window.fetch = function (url, options) {
          if (typeof url === 'string' && url.includes('chrome-extension://')) {
            return Promise.reject(new Error('Blocked extension request'));
          }
          return originalFetch.call(this, url, options);
        };

        // ‚úÖ INTERCEPTAR XMLHttpRequest para bloquear requests de extensiones
        const originalXHROpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function (method, url, async, user, password) {
          if (typeof url === 'string' && url.includes('chrome-extension://')) {
            return;
          }
          return originalXHROpen.call(this, method, url, async, user, password);
        };

        // ‚úÖ BLOQUEAR CONSOLE METHODS TEMPORALMENTE PARA EXTENSIONES
        setTimeout(() => {
          console.error = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleError.apply(console, args);
            }
          };

          console.warn = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleWarn.apply(console, args);
            }
          };

          console.log = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleLog.apply(console, args);
            }
          };
        }, 1000);

        // ‚úÖ BLOQUEAR CONSOLE METHODS DESPU√âS DE 2 SEGUNDOS TAMBI√âN
        setTimeout(() => {
          console.error = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleError.apply(console, args);
            }
          };

          console.warn = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleWarn.apply(console, args);
            }
          };

          console.log = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleLog.apply(console, args);
            }
          };
        }, 2000);

        // ‚úÖ BLOQUEAR CONSOLE METHODS DESPU√âS DE 5 SEGUNDOS TAMBI√âN
        setTimeout(() => {
          console.error = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleError.apply(console, args);
            }
          };

          console.warn = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleWarn.apply(console, args);
            }
          };

          console.log = function (...args) {
            const message = args.join(' ');
            if (!isExtensionError(message, null)) {
              originalConsoleLog.apply(console, args);
            }
          };
        }, 5000);

        // ‚úÖ LOG DE CONFIRMACI√ìN
        console.log(
          'üßπ Console Cleaner ULTRA AGRESIVO activado - Filtrando errores de extensiones'
        );
        console.log('‚úÖ Solo se mostrar√°n logs de tu aplicaci√≥n');
        console.log('üõ°Ô∏è Filtrado ultra agresivo activado');
        console.log('üö´ Bloqueando todos los errores de extensiones');
      })();
    </script>

    %sveltekit.head%
  </head>

  <body data-sveltekit-preload-data="hover">
    <div style="display: contents">%sveltekit.body%</div>
  </body>
</html>
