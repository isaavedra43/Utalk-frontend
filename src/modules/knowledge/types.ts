// üìö TIPOS CAN√ìNICOS - M√≥dulo de Centro de Conocimiento UTalk
// Sistema completo de gesti√≥n de documentos, FAQs y capacitaci√≥n

// // import type { CanonicalUser } from '@/types/canonical'

/**
 * üéØ DOCUMENTO DE CONOCIMIENTO
 */
export interface KnowledgeDocument {
  // ‚úÖ CAMPOS OBLIGATORIOS
  id: string
  title: string
  type: DocumentType
  status: DocumentStatus
  
  // ‚úÖ CONTENIDO
  description?: string
  content?: string              // Para contenido de texto/markdown
  fileUrl?: string             // URL del archivo
  fileName?: string            // Nombre original del archivo
  fileSize?: number            // Tama√±o en bytes
  mimeType?: string           // Tipo MIME
  
  // ‚úÖ CLASIFICACI√ìN
  category: KnowledgeCategory
  tags: string[]
  
  // ‚úÖ METADATOS
  createdBy: string
  updatedBy?: string
  createdAt: Date
  updatedAt: Date
  
  // ‚úÖ INTERACCIONES
  views: number
  downloads: number
  favorites: number
  isFavorite: boolean          // Para el usuario actual
  
  // ‚úÖ VISIBILIDAD Y ACCESO
  visibility: 'public' | 'private' | 'restricted'
  allowedRoles?: string[]      // Roles que pueden acceder
  allowedUsers?: string[]      // Usuarios espec√≠ficos
  
  // ‚úÖ VERSIONADO
  version: string
  previousVersions?: DocumentVersion[]
  
  // ‚úÖ METADATOS ADICIONALES
  metadata?: {
    language?: string
    difficulty?: 'beginner' | 'intermediate' | 'advanced'
    estimatedReadTime?: number  // En minutos
    keywords?: string[]
    externalUrl?: string       // Para enlaces externos
    thumbnail?: string         // URL de miniatura
    transcription?: string     // Para videos
  }
}

/**
 * üéØ TIPOS DE DOCUMENTO
 */
export type DocumentType = 
  | 'pdf'              // Documentos PDF
  | 'video'            // Videos MP4, AVI, etc.
  | 'image'            // Im√°genes PNG, JPG, etc.
  | 'excel'            // Hojas de c√°lculo
  | 'word'             // Documentos Word
  | 'powerpoint'       // Presentaciones
  | 'text'             // Archivos de texto
  | 'markdown'         // Documentos Markdown
  | 'link'             // Enlaces externos
  | 'blog'             // Art√≠culos/blogs
  | 'audio'            // Archivos de audio
  | 'zip'              // Archivos comprimidos
  | 'other'            // Otros tipos

/**
 * üéØ ESTADOS DE DOCUMENTO
 */
export type DocumentStatus = 
  | 'draft'            // Borrador
  | 'published'        // Publicado
  | 'archived'         // Archivado
  | 'under_review'     // En revisi√≥n
  | 'outdated'         // Desactualizado

/**
 * üéØ CATEGOR√çAS DE CONOCIMIENTO
 */
export interface KnowledgeCategory {
  id: string
  name: string
  description?: string
  icon?: string
  color?: string
  parentId?: string            // Para subcategor√≠as
  path: string                 // Ruta completa (ej: "productos/telefonia/configuracion")
  documentCount: number
  isExpanded?: boolean         // Para UI del √°rbol
  order: number               // Orden de visualizaci√≥n
}

/**
 * üéØ VERSI√ìN DE DOCUMENTO
 */
export interface DocumentVersion {
  id: string
  version: string
  fileUrl: string
  createdBy: string
  createdAt: Date
  changes?: string            // Descripci√≥n de cambios
  fileSize: number
}

/**
 * üéØ FAQ (PREGUNTAS FRECUENTES)
 */
export interface KnowledgeFAQ {
  // ‚úÖ CAMPOS OBLIGATORIOS
  id: string
  question: string
  answer: string
  
  // ‚úÖ CLASIFICACI√ìN
  category: KnowledgeCategory
  tags: string[]
  
  // ‚úÖ METADATOS
  createdBy: string
  updatedBy?: string
  createdAt: Date
  updatedAt: Date
  
  // ‚úÖ INTERACCIONES
  views: number
  likes: number
  dislikes: number
  isHelpful?: boolean         // Para el usuario actual
  
  // ‚úÖ ESTADO
  status: 'published' | 'draft' | 'archived'
  priority: 'low' | 'medium' | 'high'
  
  // ‚úÖ CONTENIDO ADICIONAL
  relatedDocuments?: string[] // IDs de documentos relacionados
  relatedFAQs?: string[]      // IDs de FAQs relacionadas
  
  // ‚úÖ METADATOS
  metadata?: {
    keywords?: string[]
    difficulty?: 'beginner' | 'intermediate' | 'advanced'
    estimatedReadTime?: number
  }
}

/**
 * üéØ CURSO DE CAPACITACI√ìN
 */
export interface KnowledgeCourse {
  // ‚úÖ CAMPOS OBLIGATORIOS
  id: string
  title: string
  description: string
  
  // ‚úÖ CONTENIDO
  lessons: CourseLesson[]
  totalLessons: number
  estimatedDuration: number   // En minutos
  
  // ‚úÖ CLASIFICACI√ìN
  category: KnowledgeCategory
  tags: string[]
  difficulty: 'beginner' | 'intermediate' | 'advanced'
  
  // ‚úÖ METADATOS
  createdBy: string
  updatedBy?: string
  createdAt: Date
  updatedAt: Date
  
  // ‚úÖ ESTADO
  status: 'published' | 'draft' | 'archived'
  isActive: boolean
  
  // ‚úÖ INTERACCIONES
  enrolledCount: number
  completedCount: number
  averageRating: number
  
  // ‚úÖ CONFIGURACI√ìN
  requiresEnrollment: boolean
  allowedRoles?: string[]
  prerequisites?: string[]    // IDs de cursos prerequisito
  
  // ‚úÖ RECURSOS
  thumbnail?: string
  certificateTemplate?: string
  
  // ‚úÖ PROGRESO DEL USUARIO ACTUAL
  userProgress?: CourseProgress
}

/**
 * üéØ LECCI√ìN DE CURSO
 */
export interface CourseLesson {
  id: string
  title: string
  description?: string
  order: number
  
  // ‚úÖ CONTENIDO
  type: 'video' | 'document' | 'quiz' | 'assignment' | 'link'
  content?: string            // Contenido de texto/markdown
  resourceUrl?: string        // URL del recurso (video, documento, etc.)
  duration?: number           // En minutos
  
  // ‚úÖ RECURSOS ADICIONALES
  attachments?: KnowledgeDocument[]
  quiz?: CourseQuiz
  
  // ‚úÖ CONFIGURACI√ìN
  isRequired: boolean
  allowSkip: boolean
  
  // ‚úÖ PROGRESO
  userProgress?: {
    isCompleted: boolean
    completedAt?: Date
    timeSpent?: number      // En minutos
    score?: number          // Para quizzes
  }
}

/**
 * üéØ QUIZ DE CURSO
 */
export interface CourseQuiz {
  id: string
  title: string
  description?: string
  questions: QuizQuestion[]
  passingScore: number        // Porcentaje m√≠nimo para aprobar
  maxAttempts?: number
  timeLimit?: number          // En minutos
}

/**
 * üéØ PREGUNTA DE QUIZ
 */
export interface QuizQuestion {
  id: string
  question: string
  type: 'multiple_choice' | 'true_false' | 'open_ended'
  options?: string[]          // Para multiple choice
  correctAnswer: string | number
  explanation?: string
  points: number
}

/**
 * üéØ PROGRESO DE CURSO
 */
export interface CourseProgress {
  courseId: string
  userId: string
  
  // ‚úÖ PROGRESO GENERAL
  isEnrolled: boolean
  isCompleted: boolean
  enrolledAt: Date
  completedAt?: Date
  lastAccessedAt: Date
  
  // ‚úÖ M√âTRICAS
  completedLessons: number
  totalLessons: number
  progressPercentage: number
  timeSpent: number           // En minutos
  
  // ‚úÖ PROGRESO POR LECCI√ìN
  lessonProgress: Record<string, {
    isCompleted: boolean
    completedAt?: Date
    timeSpent: number
    score?: number
  }>
  
  // ‚úÖ QUIZZES
  quizResults: QuizResult[]
  
  // ‚úÖ CERTIFICACI√ìN
  certificate?: {
    issuedAt: Date
    certificateUrl: string
    score: number
  }
}

/**
 * üéØ RESULTADO DE QUIZ
 */
export interface QuizResult {
  quizId: string
  lessonId: string
  attempt: number
  score: number
  totalPoints: number
  passed: boolean
  completedAt: Date
  timeSpent: number
  answers: Record<string, any>
}

/**
 * üéØ ACTIVIDAD DEL CENTRO DE CONOCIMIENTO
 */
export interface KnowledgeActivity {
  id: string
  type: ActivityType
  userId: string
  userName: string
  userAvatar?: string
  
  // ‚úÖ CONTENIDO DE LA ACTIVIDAD
  resourceType: 'document' | 'faq' | 'course' | 'category'
  resourceId: string
  resourceTitle: string
  
  // ‚úÖ DETALLES
  action: string              // 'created', 'updated', 'viewed', 'completed', etc.
  description: string
  timestamp: Date
  
  // ‚úÖ METADATOS
  metadata?: {
    oldValue?: any
    newValue?: any
    duration?: number
    score?: number
  }
}

/**
 * üéØ TIPOS DE ACTIVIDAD
 */
export type ActivityType = 
  | 'document_created'
  | 'document_updated'
  | 'document_viewed'
  | 'document_downloaded'
  | 'document_favorited'
  | 'faq_created'
  | 'faq_updated'
  | 'faq_viewed'
  | 'course_enrolled'
  | 'course_completed'
  | 'lesson_completed'
  | 'quiz_attempted'
  | 'category_created'

/**
 * üéØ ESTAD√çSTICAS DEL CENTRO DE CONOCIMIENTO
 */
export interface KnowledgeStats {
  // ‚úÖ CONTADORES GENERALES
  totalDocuments: number
  totalFAQs: number
  totalCourses: number
  totalCategories: number
  
  // ‚úÖ ACTIVIDAD
  totalViews: number
  totalDownloads: number
  totalFavorites: number
  
  // ‚úÖ USUARIOS
  activeUsers: number
  totalEnrollments: number
  completedCourses: number
  
  // ‚úÖ CONTENIDO POR TIPO
  documentsByType: Record<DocumentType, number>
  
  // ‚úÖ ACTIVIDAD RECIENTE
  recentActivity: KnowledgeActivity[]
  
  // ‚úÖ M√âTRICAS DE TIEMPO
  averageViewTime: number     // En minutos
  averageCourseCompletion: number // Porcentaje
  
  // ‚úÖ TOP CONTENIDO
  mostViewedDocuments: KnowledgeDocument[]
  mostPopularCourses: KnowledgeCourse[]
  mostHelpfulFAQs: KnowledgeFAQ[]
}

/**
 * üéØ FILTROS DE B√öSQUEDA
 */
export interface KnowledgeFilters {
  // ‚úÖ B√öSQUEDA
  search?: string
  
  // ‚úÖ FILTROS B√ÅSICOS
  type?: DocumentType[]
  status?: DocumentStatus[]
  categories?: string[]        // IDs de categor√≠as
  tags?: string[]
  
  // ‚úÖ FILTROS TEMPORALES
  dateFrom?: Date
  dateTo?: Date
  
  // ‚úÖ FILTROS DE INTERACCI√ìN
  onlyFavorites?: boolean
  onlyRecent?: boolean
  minViews?: number
  
  // ‚úÖ FILTROS DE USUARIO
  createdBy?: string[]
  assignedTo?: string[]
  
  // ‚úÖ ORDENAMIENTO
  sortBy?: 'title' | 'createdAt' | 'updatedAt' | 'views' | 'downloads' | 'relevance'
  sortOrder?: 'asc' | 'desc'
  
  // ‚úÖ PAGINACI√ìN
  page?: number
  limit?: number
}

/**
 * üéØ CONFIGURACI√ìN DEL M√ìDULO
 */
export interface KnowledgeModuleConfig {
  // ‚úÖ L√çMITES DE ARCHIVOS
  maxFileSize: number         // En bytes
  allowedFileTypes: string[]  // MIME types permitidos
  maxFilesPerUpload: number
  
  // ‚úÖ CONFIGURACI√ìN DE CURSOS
  enableCourses: boolean
  enableCertificates: boolean
  defaultCourseEnrollment: boolean
  
  // ‚úÖ CONFIGURACI√ìN DE FAQs
  enableFAQs: boolean
  allowUserSubmissions: boolean
  requireApproval: boolean
  
  // ‚úÖ PERMISOS
  permissions: {
    canCreateDocuments: boolean
    canEditDocuments: boolean
    canDeleteDocuments: boolean
    canCreateCourses: boolean
    canManageCategories: boolean
    canViewAnalytics: boolean
  }
  
  // ‚úÖ CONFIGURACI√ìN DE UI
  defaultView: 'grid' | 'list'
  enableThumbnails: boolean
  enablePreviews: boolean
  enableVersioning: boolean
}

/**
 * üéØ RESPUESTAS DE API
 */
export interface KnowledgeDocumentsResponse {
  success: boolean
  documents: KnowledgeDocument[]
  total: number
  page: number
  limit: number
  error?: string
}

export interface KnowledgeDocumentResponse {
  success: boolean
  document?: KnowledgeDocument
  error?: string
}

export interface KnowledgeFAQsResponse {
  success: boolean
  faqs: KnowledgeFAQ[]
  total: number
  page: number
  limit: number
  error?: string
}

export interface KnowledgeCoursesResponse {
  success: boolean
  courses: KnowledgeCourse[]
  total: number
  page: number
  limit: number
  error?: string
}

export interface KnowledgeCategoriesResponse {
  success: boolean
  categories: KnowledgeCategory[]
  error?: string
}

export interface KnowledgeStatsResponse {
  success: boolean
  stats?: KnowledgeStats
  error?: string
}

/**
 * üéØ ACCIONES DEL M√ìDULO
 */
export type KnowledgeAction = 
  | 'create'
  | 'edit'
  | 'delete'
  | 'view'
  | 'download'
  | 'favorite'
  | 'share'
  | 'archive'
  | 'restore'

/**
 * üéØ EVENTOS DEL M√ìDULO
 */
export interface KnowledgeEvent {
  id: string
  type: ActivityType
  resourceId: string
  userId: string
  timestamp: Date
  data?: Record<string, any>
}

// ‚úÖ CONSTANTES √öTILES
export const DOCUMENT_TYPE_LABELS: Record<DocumentType, string> = {
  pdf: 'PDF',
  video: 'Video',
  image: 'Imagen',
  excel: 'Excel',
  word: 'Word',
  powerpoint: 'PowerPoint',
  text: 'Texto',
  markdown: 'Markdown',
  link: 'Enlace',
  blog: 'Blog',
  audio: 'Audio',
  zip: 'Archivo ZIP',
  other: 'Otro'
}

export const DOCUMENT_TYPE_ICONS: Record<DocumentType, string> = {
  pdf: 'üìÑ',
  video: 'üé•',
  image: 'üñºÔ∏è',
  excel: 'üìä',
  word: 'üìù',
  powerpoint: 'üìΩÔ∏è',
  text: 'üìÉ',
  markdown: 'üìã',
  link: 'üîó',
  blog: '‚úèÔ∏è',
  audio: 'üéµ',
  zip: 'üì¶',
  other: 'üìÅ'
}

export const DOCUMENT_STATUS_LABELS: Record<DocumentStatus, string> = {
  draft: 'Borrador',
  published: 'Publicado',
  archived: 'Archivado',
  under_review: 'En Revisi√≥n',
  outdated: 'Desactualizado'
}

export const DIFFICULTY_LABELS = {
  beginner: 'Principiante',
  intermediate: 'Intermedio',
  advanced: 'Avanzado'
}

export const MIME_TYPE_MAPPINGS: Record<string, DocumentType> = {
  'application/pdf': 'pdf',
  'video/mp4': 'video',
  'video/avi': 'video',
  'video/quicktime': 'video',
  'image/jpeg': 'image',
  'image/png': 'image',
  'image/gif': 'image',
  'image/webp': 'image',
  'application/vnd.ms-excel': 'excel',
  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'excel',
  'application/msword': 'word',
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'word',
  'application/vnd.ms-powerpoint': 'powerpoint',
  'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'powerpoint',
  'text/plain': 'text',
  'text/markdown': 'markdown',
  'audio/mpeg': 'audio',
  'audio/wav': 'audio',
  'application/zip': 'zip'
} 