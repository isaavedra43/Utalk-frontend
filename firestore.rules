rules_version = '2';

/**
 * Reglas de seguridad de Firestore para sistema omnicanal
 * CONFIGURACIÓN PARA PRODUCCIÓN
 * 
 * IMPORTANTE: Estas reglas bloquean todo acceso desde el frontend
 * Solo el backend con Admin SDK puede acceder a los datos
 * 
 * Para aplicar estas reglas:
 * 1. Instalar Firebase CLI: npm install -g firebase-tools
 * 2. Iniciar sesión: firebase login
 * 3. Seleccionar proyecto: firebase use <PROJECT_ID>
 * 4. Desplegar reglas: firebase deploy --only firestore:rules
 */

service cloud.firestore {
  match /databases/{database}/documents {
    
    // REGLA PRINCIPAL: Denegar todo acceso desde clientes
    // Solo el Admin SDK del backend puede acceder
    match /{document=**} {
      allow read, write: if false;
    }
    
    // OPCIONAL: Reglas específicas para desarrollo/testing
    // Descomenta solo si necesitas acceso directo desde frontend en desarrollo
    /*
    match /test/{document} {
      allow read, write: if request.auth != null;
    }
    */
    
    // OPCIONAL: Reglas para logs públicos (si los necesitas)
    // Descomenta solo si necesitas logs accesibles desde frontend
    /*
    match /public_logs/{document} {
      allow read: if true;
      allow write: if false;
    }
    */
  }
}

/**
 * NOTAS IMPORTANTES:
 * 
 * 1. SEGURIDAD:
 *    - Estas reglas bloquean todo acceso desde frontend/móvil
 *    - Solo el backend con Admin SDK puede leer/escribir datos
 *    - Esto garantiza que toda la lógica de negocio esté en el backend
 * 
 * 2. BACKEND ACCESS:
 *    - El Admin SDK bypasea estas reglas automáticamente
 *    - Asegúrate de mantener las credenciales del Admin SDK seguras
 *    - Nunca expongas las credenciales del Admin SDK en el frontend
 * 
 * 3. ESTRUCTURA DE DATOS:
 *    - clients: Información de clientes
 *    - conversations: Conversaciones omnicanal
 *    - messages: Mensajes de todas las conversaciones
 *    - campaigns: Campañas de marketing
 *    - users: Usuarios del sistema (agentes, admin)
 *    - settings: Configuración del sistema
 * 
 * 4. MONITOREO:
 *    - Usa Firebase Console para monitorear accesos denegados
 *    - Configura alertas para intentos de acceso sospechosos
 *    - Revisa logs regularmente
 * 
 * 5. DESARROLLO:
 *    - Para desarrollo local, puedes usar el emulador de Firestore
 *    - firebase emulators:start --only firestore
 *    - Esto permite testing sin afectar producción
 * 
 * 6. BACKUP:
 *    - Configura backups automáticos en Firebase Console
 *    - Considera export/import para migraciones
 *    - Mantén copias de seguridad de estas reglas
 */ 